services:

    force-attach:
      image: bash
      command: tail -f /dev/null

    api:
        build:
            context: ./
            dockerfile: dockerFiles/api_docker
        ports:
            - "8000:8000"
        depends_on:
            - mongo
            - celery
            - tor-extended-1
            - tor-extended-2
            - tor-extended-3
            - tor-extended-4
            - tor-extended-5
        networks:
            backend:
                ipv4_address: 10.0.0.2
        volumes:
            - ./app/:/app

    redis_server:
        image: redis
        logging:
            driver: none
        command: redis-server --requirepass killprg1
        networks:
            backend:
                ipv4_address: 10.0.0.3

    celery:
        build:
            context: ./
            dockerfile: dockerFiles/celery_docker

        environment:
            REDISSERVER: redis://redis_server:6379
            C_FORCE_ROOT: "true"
        depends_on:
            - redis_server
            - tor-extended-1
            - tor-extended-2
            - tor-extended-3
            - tor-extended-4
            - tor-extended-5
        networks:
            backend:
                ipv4_address: 10.0.0.4
        logging:
            driver: local
        volumes:
            - ./app/:/app

    mongo:
        image: mongo
        container_name: mongo-db
        command: mongod --quiet --logpath /dev/null
        logging:
            driver: none
        volumes:
            - ./data/db:/data/db
        ports:
            - "27017:27017"
        networks:
            backend:
                ipv4_address: 10.0.0.5

    tor-extended-1:
        container_name: tor_1
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '0.0.0.0:9052'
            TOR_PROXY_ACCEPT: 'accept 10.0.0.0/24'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '0.0.0.0:9053'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'

        volumes:
            - ./tor:/data/tor
        ports:
            - "9052:9052/tcp"
        restart: unless-stopped
        networks:
            backend:
                ipv4_address: 10.0.0.6

    tor-extended-2:
        container_name: tor_2
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '0.0.0.0:9054'
            TOR_PROXY_ACCEPT: 'accept 10.0.0.0/24'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '0.0.0.0:9055'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'

        volumes:
            - ./tor:/data/tor
        ports:
            - "9054:9054/tcp"
        restart: unless-stopped
        networks:
            backend:
                ipv4_address: 10.0.0.7

    tor-extended-3:
        container_name: tor_3
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '0.0.0.0:9056'
            TOR_PROXY_ACCEPT: 'accept 10.0.0.0/24'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '0.0.0.0:9057'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'

        volumes:
            - ./tor:/data/tor
        ports:
            - "9056:9056/tcp"
        restart: unless-stopped
        networks:
            backend:
                ipv4_address: 10.0.0.8

    tor-extended-4:
        container_name: tor_4
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '0.0.0.0:9058'
            TOR_PROXY_ACCEPT: 'accept 10.0.0.0/24'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '0.0.0.0:9059'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'

        volumes:
            - ./tor:/data/tor
        ports:
            - "9058:9058/tcp"
        restart: unless-stopped
        networks:
            backend:
                ipv4_address: 10.0.0.9

    tor-extended-5:
        container_name: tor_5
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '0.0.0.0:9060'
            TOR_PROXY_ACCEPT: 'accept 10.0.0.0/24'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '0.0.0.0:9061'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'

        volumes:
            - ./tor:/data/tor
        ports:
            - "9060:9060/tcp"
        restart: unless-stopped
        networks:
            backend:
                ipv4_address: 10.0.0.10

networks:
  backend:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 10.0.0.0/24

services:

    force-attach:
      image: bash
      command: tail -f /dev/null

    api:
        build:
            context: ./
            dockerfile: dockerFiles/api_docker
        ports:
            - "8000:8000"
        depends_on:
            - mongo
            - tor-extend-2
            - tor-extend-3
            - tor-extend-4
            - tor-extend-5
            - tor-extend-6
            - tor-extend-7
            - tor-extend-8
            - tor-extend-9
            - tor-extend-10
            - tor-extend-11
            - tor-extend-12
            - tor-extend-13
            - tor-extend-14
            - tor-extend-15
            - tor-extend-16
            - tor-extend-17
            - tor-extend-18
            - tor-extend-19
            - tor-extend-20
            - tor-extend-21
            - tor-extend-22
            - tor-extend-23
            - tor-extend-24
            - tor-extend-25
            - tor-extend-26
            - tor-extend-27
            - tor-extend-28
            - tor-extend-29
            - tor-extend-30

        networks:
            backend:
                ipv4_address: 172.0.0.2
        deploy:
          resources:
            limits:
              memory: 8G

        restart: always
        volumes:
            - ./app/:/app

    redis_server:
        image: redis
        logging:
            driver: none
        command: redis-server --requirepass killprg1
        networks:
            backend:
                ipv4_address: 172.0.0.3
    mongo:
        image: mongo
        container_name: mongo-db
        command: mongod --quiet --logpath /dev/null
        logging:
            driver: none
        volumes:
            - ./data/db:/data/db
        ports:
            - "27017:27017"
        networks:
            backend:
                ipv4_address: 172.0.0.5

    tor-extend-2:
        container_name: tor_instace_2
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '9054'
            TOR_PROXY_ACCEPT: 'accept 127.0.0.1,accept 172.0.0.0/8,accept 172.16.0.0/12,accept 192.168.0.0/16'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '9055'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'

        volumes:
            - ./tor:/data/tor
        ports:
            - "9054:9054/tcp"
        restart: unless-stopped
        networks:
            backend:
                ipv4_address: 172.0.0.7
    tor-extend-3:
        container_name: tor_instace_3
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '9056'
            TOR_PROXY_ACCEPT: 'accept 127.0.0.1,accept 172.0.0.0/8,accept 172.16.0.0/12,accept 192.168.0.0/16'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '9057'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'
        volumes:
            - ./tor:/data/tor
        ports:
            - "9056:9056/tcp"
        restart: unless-stopped
        networks:
            backend:
                ipv4_address: 172.0.0.8
    tor-extend-4:
        container_name: tor_instace_4
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '9058'
            TOR_PROXY_ACCEPT: 'accept 127.0.0.1,accept 172.0.0.0/8,accept 172.16.0.0/12,accept 192.168.0.0/16'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '9059'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'
        volumes:
            - ./tor:/data/tor
        ports:
            - "9058:9058/tcp"
        restart: unless-stopped
        networks:
            backend:
                ipv4_address: 172.0.0.9
    tor-extend-5:
        container_name: tor_instace_5
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '9060'
            TOR_PROXY_ACCEPT: 'accept 127.0.0.1,accept 172.0.0.0/8,accept 172.16.0.0/12,accept 192.168.0.0/16'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '9061'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'
        volumes:
            - ./tor:/data/tor
        ports:
            - "9060:9060/tcp"
        restart: unless-stopped
        networks:
            backend:
                ipv4_address: 172.0.0.10
    tor-extend-6:
        container_name: tor_instace_6
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '9062'
            TOR_PROXY_ACCEPT: 'accept 127.0.0.1,accept 172.0.0.0/8,accept 172.16.0.0/12,accept 192.168.0.0/16'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '9063'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'
        volumes:
            - ./tor:/data/tor
        ports:
            - "9062:9062/tcp"
        restart: unless-stopped
        networks:
            backend:
                ipv4_address: 172.0.0.11
    tor-extend-7:
        container_name: tor_instace_7
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '9064'
            TOR_PROXY_ACCEPT: 'accept 127.0.0.1,accept 172.0.0.0/8,accept 172.16.0.0/12,accept 192.168.0.0/16'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '9065'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'
        volumes:
            - ./tor:/data/tor
        ports:
            - "9064:9064/tcp"
        restart: unless-stopped
        networks:
            backend:
                ipv4_address: 172.0.0.12
    tor-extend-8:
        container_name: tor_instace_8
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '9066'
            TOR_PROXY_ACCEPT: 'accept 127.0.0.1,accept 172.0.0.0/8,accept 172.16.0.0/12,accept 192.168.0.0/16'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '9067'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'
        volumes:
            - ./tor:/data/tor
        ports:
            - "9066:9066/tcp"
        restart: unless-stopped
        networks:
            backend:
                ipv4_address: 172.0.0.13
    tor-extend-9:
        container_name: tor_instace_9
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '9068'
            TOR_PROXY_ACCEPT: 'accept 127.0.0.1,accept 172.0.0.0/8,accept 172.16.0.0/12,accept 192.168.0.0/16'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '9069'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'
        volumes:
            - ./tor:/data/tor
        ports:
            - "9068:9068/tcp"
        restart: unless-stopped
        networks:
            backend:
                ipv4_address: 172.0.0.14
    tor-extend-10:
        container_name: tor_instace_10
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '9070'
            TOR_PROXY_ACCEPT: 'accept 127.0.0.1,accept 172.0.0.0/8,accept 172.16.0.0/12,accept 192.168.0.0/16'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '9071'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'
        volumes:
            - ./tor:/data/tor
        ports:
            - "9070:9070/tcp"
        networks:
            backend:
                ipv4_address: 172.0.0.15
    tor-extend-11:
        container_name: tor_instace_11
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '9072'
            TOR_PROXY_ACCEPT: 'accept 127.0.0.1,accept 172.0.0.0/8,accept 172.16.0.0/12,accept 192.168.0.0/16'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '9073'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'
        volumes:
            - ./tor:/data/tor
        ports:
            - "9072:9072/tcp"
        restart: unless-stopped
        networks:
            backend:
                ipv4_address: 172.0.0.16
    tor-extend-12:
        container_name: tor_instace_12
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '9074'
            TOR_PROXY_ACCEPT: 'accept 127.0.0.1,accept 172.0.0.0/8,accept 172.16.0.0/12,accept 192.168.0.0/16'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '9075'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'
        volumes:
            - ./tor:/data/tor
        ports:
            - "9074:9074/tcp"
        restart: unless-stopped
        networks:
            backend:
                ipv4_address: 172.0.0.17
    tor-extend-13:
        container_name: tor_instace_13
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '9076'
            TOR_PROXY_ACCEPT: 'accept 127.0.0.1,accept 172.0.0.0/8,accept 172.16.0.0/12,accept 192.168.0.0/16'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '9077'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'
        volumes:
            - ./tor:/data/tor
        ports:
            - "9076:9076/tcp"
        restart: unless-stopped
        networks:
            backend:
                ipv4_address: 172.0.0.18
    tor-extend-14:
        container_name: tor_instace_14
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '9078'
            TOR_PROXY_ACCEPT: 'accept 127.0.0.1,accept 172.0.0.0/8,accept 172.16.0.0/12,accept 192.168.0.0/16'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '9079'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'
        volumes:
            - ./tor:/data/tor
        ports:
            - "9078:9078/tcp"
        restart: unless-stopped
        networks:
            backend:
                ipv4_address: 172.0.0.19
    tor-extend-15:
        container_name: tor_instace_15
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '9080'
            TOR_PROXY_ACCEPT: 'accept 127.0.0.1,accept 172.0.0.0/8,accept 172.16.0.0/12,accept 192.168.0.0/16'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '9081'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'
        volumes:
            - ./tor:/data/tor
        ports:
            - "9080:9080/tcp"
        restart: unless-stopped
        networks:
            backend:
                ipv4_address: 172.0.0.20
    tor-extend-16:
        container_name: tor_instace_16
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '9082'
            TOR_PROXY_ACCEPT: 'accept 127.0.0.1,accept 172.0.0.0/8,accept 172.16.0.0/12,accept 192.168.0.0/16'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '9083'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'
        volumes:
            - ./tor:/data/tor
        ports:
            - "9082:9082/tcp"
        restart: unless-stopped
        networks:
            backend:
                ipv4_address: 172.0.0.21
    tor-extend-17:
        container_name: tor_instace_17
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '9084'
            TOR_PROXY_ACCEPT: 'accept 127.0.0.1,accept 172.0.0.0/8,accept 172.16.0.0/12,accept 192.168.0.0/16'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '9085'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'
        volumes:
            - ./tor:/data/tor
        ports:
            - "9084:9084/tcp"
        restart: unless-stopped
        networks:
            backend:
                ipv4_address: 172.0.0.22
    tor-extend-18:
        container_name: tor_instace_18
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '9086'
            TOR_PROXY_ACCEPT: 'accept 127.0.0.1,accept 172.0.0.0/8,accept 172.16.0.0/12,accept 192.168.0.0/16'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '9087'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'
        volumes:
            - ./tor:/data/tor
        ports:
            - "9086:9086/tcp"
        restart: unless-stopped
        networks:
            backend:
                ipv4_address: 172.0.0.23
    tor-extend-19:
        container_name: tor_instace_19
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '9088'
            TOR_PROXY_ACCEPT: 'accept 127.0.0.1,accept 172.0.0.0/8,accept 172.16.0.0/12,accept 192.168.0.0/16'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '9089'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'
        volumes:
            - ./tor:/data/tor
        ports:
            - "9088:9088/tcp"
        restart: unless-stopped
        networks:
            backend:
                ipv4_address: 172.0.0.24
    tor-extend-20:
        container_name: tor_instace_20
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '9090'
            TOR_PROXY_ACCEPT: 'accept 127.0.0.1,accept 172.0.0.0/8,accept 172.16.0.0/12,accept 192.168.0.0/16'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '9091'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'
        volumes:
            - ./tor:/data/tor
        ports:
            - "9090:9090/tcp"
        restart: unless-stopped
        networks:
            backend:
                ipv4_address: 172.0.0.25
    tor-extend-21:
        container_name: tor_instace_21
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '9092'
            TOR_PROXY_ACCEPT: 'accept 127.0.0.1,accept 172.0.0.0/8,accept 172.16.0.0/12,accept 192.168.0.0/16'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '9093'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'
        volumes:
            - ./tor:/data/tor
        ports:
            - "9092:9092/tcp"
        restart: unless-stopped
        networks:
            backend:
                ipv4_address: 172.0.0.26
    tor-extend-22:
        container_name: tor_instace_22
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '9094'
            TOR_PROXY_ACCEPT: 'accept 127.0.0.1,accept 172.0.0.0/8,accept 172.16.0.0/12,accept 192.168.0.0/16'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '9095'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'
        volumes:
            - ./tor:/data/tor
        ports:
            - "9094:9094/tcp"
        restart: unless-stopped
        networks:
            backend:
                ipv4_address: 172.0.0.27

    tor-extend-23:
        container_name: tor_instace_23
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '9096'
            TOR_PROXY_ACCEPT: 'accept 127.0.0.1,accept 172.0.0.0/8,accept 172.16.0.0/12,accept 192.168.0.0/16'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '9097'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'
        volumes:
            - ./tor:/data/tor
        ports:
            - "9096:9096/tcp"
        restart: unless-stopped
        networks:
            backend:
                ipv4_address: 172.0.0.28

    tor-extend-24:
        container_name: tor_instace_24
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '9098'
            TOR_PROXY_ACCEPT: 'accept 127.0.0.1,accept 172.0.0.0/8,accept 172.16.0.0/12,accept 192.168.0.0/16'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '9099'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'
        volumes:
            - ./tor:/data/tor
        ports:
            - "9098:9098/tcp"
        restart: unless-stopped
        networks:
            backend:
                ipv4_address: 172.0.0.29

    tor-extend-25:
        container_name: tor_instace_25
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '10000'
            TOR_PROXY_ACCEPT: 'accept 127.0.0.1,accept 172.0.0.0/8,accept 172.16.0.0/12,accept 192.168.0.0/16'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '10001'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'
        volumes:
            - ./tor:/data/tor
        ports:
            - "10000:10000/tcp"
        restart: unless-stopped
        networks:
            backend:
                ipv4_address: 172.0.0.30

    tor-extend-26:
        container_name: tor_instace_26
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '10002'
            TOR_PROXY_ACCEPT: 'accept 127.0.0.1,accept 172.0.0.0/8,accept 172.16.0.0/12,accept 192.168.0.0/16'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '10003'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'
        volumes:
            - ./tor:/data/tor
        ports:
            - "10002:10002/tcp"
        restart: unless-stopped
        networks:
            backend:
                ipv4_address: 172.0.0.31

    tor-extend-27:
        container_name: tor_instace_27
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '10004'
            TOR_PROXY_ACCEPT: 'accept 127.0.0.1,accept 172.0.0.0/8,accept 172.16.0.0/12,accept 192.168.0.0/16'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '10005'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'
        volumes:
            - ./tor:/data/tor
        ports:
            - "10004:10004/tcp"
        restart: unless-stopped
        networks:
            backend:
                ipv4_address: 172.0.0.32

    tor-extend-28:
        container_name: tor_instace_28
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '10006'
            TOR_PROXY_ACCEPT: 'accept 127.0.0.1,accept 172.0.0.0/8,accept 172.16.0.0/12,accept 192.168.0.0/16'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '10007'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'
        volumes:
            - ./tor:/data/tor
        ports:
            - "10006:10006/tcp"
        restart: unless-stopped
        networks:
            backend:
                ipv4_address: 172.0.0.33

    tor-extend-29:
        container_name: tor_instace_29
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '10008'
            TOR_PROXY_ACCEPT: 'accept 127.0.0.1,accept 172.0.0.0/8,accept 172.16.0.0/12,accept 192.168.0.0/16'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '10009'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'
        volumes:
            - ./tor:/data/tor
        ports:
            - "10008:10008/tcp"
        restart: unless-stopped
        networks:
            backend:
                ipv4_address: 172.0.0.34

    tor-extend-30:
        container_name: tor_instace_30
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '10010'
            TOR_PROXY_ACCEPT: 'accept 127.0.0.1,accept 172.0.0.0/8,accept 172.16.0.0/12,accept 192.168.0.0/16'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '10011'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'
        volumes:
            - ./tor:/data/tor
        ports:
            - "10010:10010/tcp"
        restart: unless-stopped
        networks:
            backend:
                ipv4_address: 172.0.0.35

networks:
  backend:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 172.0.0.0/24

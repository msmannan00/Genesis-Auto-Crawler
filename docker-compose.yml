services:

    force-attach:
      image: bash
      command: tail -f /dev/null

    api:
        build:
            context: ./
            dockerfile: dockerFiles/api_docker
        ports:
            - "8000:8000"
        depends_on:
            - mongo
            - tor-extend-1
            - tor-extend-2
            - tor-extend-3
            - tor-extend-4
            - tor-extend-5
            - tor-extend-6
            - tor-extend-7
            - tor-extend-8
            - tor-extend-9
            - tor-extend-10
            - tor-extend-11
            - tor-extend-12
        networks:
            backend:
                ipv4_address: 10.0.0.2
        restart: always
        volumes:
            - ./app/:/app

    redis_server:
        image: redis
        logging:
            driver: none
        command: redis-server --requirepass killprg1
        networks:
            backend:
                ipv4_address: 10.0.0.3
        deploy:
          resources:
            limits:
              memory: 4G
    mongo:
        image: mongo
        container_name: mongo-db
        command: mongod --quiet --logpath /dev/null
        logging:
            driver: none
        volumes:
            - ./data/db:/data/db
        ports:
            - "27017:27017"
        networks:
            backend:
                ipv4_address: 10.0.0.5

    tor-extend-1:
        container_name: tor_instace_1
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '0.0.0.0:9052'
            TOR_PROXY_ACCEPT: 'accept 10.0.0.0/24'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '0.0.0.0:9053'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'
        volumes:
            - ./tor:/data/tor
        ports:
            - "9052:9052/tcp"
        restart: unless-stopped
        networks:
            backend:
                ipv4_address: 10.0.0.6

    tor-extend-2:
        container_name: tor_instace_2
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '0.0.0.0:9054'
            TOR_PROXY_ACCEPT: 'accept 10.0.0.0/24'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '0.0.0.0:9055'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'

        volumes:
            - ./tor:/data/tor
        ports:
            - "9054:9054/tcp"
        restart: unless-stopped
        networks:
            backend:
                ipv4_address: 10.0.0.7

    tor-extend-3:
        container_name: tor_instace_3
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '0.0.0.0:9056'
            TOR_PROXY_ACCEPT: 'accept 10.0.0.0/24'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '0.0.0.0:9057'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'
        volumes:
            - ./tor:/data/tor
        ports:
            - "9056:9056/tcp"
        restart: unless-stopped
        networks:
            backend:
                ipv4_address: 10.0.0.8

    tor-extend-4:
        container_name: tor_instace_4
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '0.0.0.0:9058'
            TOR_PROXY_ACCEPT: 'accept 10.0.0.0/24'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '0.0.0.0:9059'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'
        volumes:
            - ./tor:/data/tor
        ports:
            - "9058:9058/tcp"
        restart: unless-stopped
        networks:
            backend:
                ipv4_address: 10.0.0.9

    tor-extend-5:
        container_name: tor_instace_5
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '0.0.0.0:9060'
            TOR_PROXY_ACCEPT: 'accept 10.0.0.0/24'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '0.0.0.0:9061'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'
        volumes:
            - ./tor:/data/tor
        ports:
            - "9060:9060/tcp"
        restart: unless-stopped
        networks:
            backend:
                ipv4_address: 10.0.0.10

    tor-extend-6:
        container_name: tor_instace_6
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '0.0.0.0:9062'
            TOR_PROXY_ACCEPT: 'accept 10.0.0.0/24'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '0.0.0.0:9063'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'
        volumes:
            - ./tor:/data/tor
        ports:
            - "9062:9062/tcp"
        restart: unless-stopped
        networks:
            backend:
                ipv4_address: 10.0.0.11

    tor-extend-7:
        container_name: tor_instace_7
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '0.0.0.0:9064'
            TOR_PROXY_ACCEPT: 'accept 10.0.0.0/24'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '0.0.0.0:9065'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'
        volumes:
            - ./tor:/data/tor
        ports:
            - "9064:9064/tcp"
        restart: unless-stopped
        networks:
            backend:
                ipv4_address: 10.0.0.12

    tor-extend-8:
        container_name: tor_instace_8
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '0.0.0.0:9066'
            TOR_PROXY_ACCEPT: 'accept 10.0.0.0/24'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '0.0.0.0:9067'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'
        volumes:
            - ./tor:/data/tor
        ports:
            - "9066:9066/tcp"
        restart: unless-stopped
        networks:
            backend:
                ipv4_address: 10.0.0.13

    tor-extend-9:
        container_name: tor_instace_9
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '0.0.0.0:9068'
            TOR_PROXY_ACCEPT: 'accept 10.0.0.0/24'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '0.0.0.0:9069'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'
        volumes:
            - ./tor:/data/tor
        ports:
            - "9068:9068/tcp"
        restart: unless-stopped
        networks:
            backend:
                ipv4_address: 10.0.0.14

    tor-extend-10:
        container_name: tor_instace_10
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '0.0.0.0:9070'
            TOR_PROXY_ACCEPT: 'accept 10.0.0.0/24'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '0.0.0.0:9071'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'
        volumes:
            - ./tor:/data/tor
        ports:
            - "9070:9070/tcp"
        restart: unless-stopped
        networks:
            backend:
                ipv4_address: 10.0.0.15

    tor-extend-11:
        container_name: tor_instace_11
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '0.0.0.0:9072'
            TOR_PROXY_ACCEPT: 'accept 10.0.0.0/24'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '0.0.0.0:9073'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'
        volumes:
            - ./tor:/data/tor
        ports:
            - "9072:9072/tcp"
        restart: unless-stopped
        networks:
            backend:
                ipv4_address: 10.0.0.16

    tor-extend-12:
        container_name: tor_instace_12
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '0.0.0.0:9074'
            TOR_PROXY_ACCEPT: 'accept 10.0.0.0/24'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '0.0.0.0:9075'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'
        volumes:
            - ./tor:/data/tor
        ports:
            - "9074:9074/tcp"
        restart: unless-stopped
        networks:
            backend:
                ipv4_address: 10.0.0.17

networks:
  backend:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 10.0.0.0/24

version: "3.3"

services:

    force-attach:
      image: bash
      command: tail -f /dev/null

    api:
        build:
            context: ./
            dockerfile: dockerFiles/api_docker
        ports:
            - "8000:8000"
        depends_on:
            - mongo
            - celery
            - tor
        networks:
            backend:
                ipv4_address: 10.0.0.2
        volumes:
            - ./app/:/app

    redis_server:
        image: redis
        logging:
            driver: none
        command: redis-server --requirepass killprg1
        networks:
            backend:
                ipv4_address: 10.0.0.3

    tor:
        build:
            context: ./
            dockerfile: dockerFiles/tor_docker
        networks:
            backend:
                ipv4_address: 10.0.0.4


    celery:
        build:
            context: ./
            dockerfile: dockerFiles/celery_docker

        environment:
            REDISSERVER: redis://redis_server:6379
            C_FORCE_ROOT: "true"
        depends_on:
            - redis_server
            - tor
        networks:
            backend:
                ipv4_address: 10.0.0.5
        logging:
            driver: local
        volumes:
            - ./app/:/app

    mongo:
        image: mongo
        container_name: mongo-db
        command: mongod --quiet --logpath /dev/null
        logging:
            driver: none
        volumes:
            - ./data/db:/data/db
        ports:
            - "27017:27017"
        networks:
            backend:
                ipv4_address: 10.0.0.6

networks:
  backend:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 10.0.0.0/24

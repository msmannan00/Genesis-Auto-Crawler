services:

    force-attach:
      image: bash
      command: tail -f /dev/null

    api:
        build:
            context: ./
            dockerfile: dockerFiles/api_docker
        ports:
            - "8000:8000"
        depends_on:
            - mongo
            - celery
            - multitor
        networks:
            backend:
                ipv4_address: 10.0.0.2
        volumes:
            - ./app/:/app

    redis_server:
        image: redis
        logging:
            driver: none
        command: redis-server --requirepass killprg1
        networks:
            backend:
                ipv4_address: 10.0.0.3

    celery:
        build:
            context: ./
            dockerfile: dockerFiles/celery_docker

        environment:
            REDISSERVER: redis://redis_server:6379
            C_FORCE_ROOT: "true"
        depends_on:
            - redis_server
            - multitor
        networks:
            backend:
                ipv4_address: 10.0.0.4
        logging:
            driver: local
        volumes:
            - ./app/:/app

    mongo:
        image: mongo
        container_name: mongo-db
        command: mongod --quiet --logpath /dev/null
        logging:
            driver: none
        volumes:
            - ./data/db:/data/db
        ports:
            - "27017:27017"
        networks:
            backend:
                ipv4_address: 10.0.0.5

    multitor:
        build:
            context: ./
            dockerfile: dockerFiles/tor_docker
    tor-extended-1:
        container_name: tor_1
        image: barneybuffet/tor:latest
        environment:
            TOR_PROXY: 'true'
            TOR_PROXY_PORT: '0.0.0.0:9052'
            TOR_PROXY_ACCEPT: 'accept 10.0.0.0/24'
            TOR_CONTROL: 'false'
            TOR_CONTROL_PORT: '0.0.0.0:9053'
            TOR_CONTROL_PASSWORD: 'Imammehdi@00'
            TOR_CONTROL_COOKIE: 'true'
            TOR_CONFIG_OVERWRITE: 'true'

        volumes:
            - ./tor:/data/tor
        ports:
           - "16379:16379"
           - "9150:9150"
           - "9151:9151"
           - "9152:9152"
           - "9153:9153"
           - "9154:9154"
        networks:
            backend:
                ipv4_address: 10.0.0.6

networks:
  backend:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 10.0.0.0/24
